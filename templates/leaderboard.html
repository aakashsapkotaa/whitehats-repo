<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard - EduHub</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="bg-glow"></div>

    <nav class="navbar">
        <div style="display:flex; align-items:center; gap:12px;">
            <a href="/dashboard" style="display:flex; align-items:center; gap:12px; text-decoration:none; color:white;">
                <img src="/static/images/LOGO_WHITE.png" style="width:32px; height:32px; object-fit:contain;">
                <span style="font-weight:700; font-size:20px;">EduHub</span>
            </a>
        </div>
        <div style="display:flex; align-items:center; gap:20px;">
            <a href="/dashboard" style="color:#ccc; text-decoration:none;">Dashboard</a>
            <a href="/browse" style="color:#ccc; text-decoration:none;">Browse</a>
            <a href="/community" style="color:#ccc; text-decoration:none;">Community</a>
            <a href="/leaderboard" style="color:#55D6BE; text-decoration:none; font-weight:600;">Leaderboard</a>
            <button onclick="logout()" style="background:none; border:none; color:#999; cursor:pointer;"><i
                    class="fas fa-sign-out-alt"></i></button>
        </div>
    </nav>

    <main style="min-height:calc(100vh - 64px); padding:32px; padding-top:96px;">
        <div style="max-width:800px; margin:0 auto;">
            <div style="text-align:center; margin-bottom:40px;">
                <h1 style="font-size:32px; margin-bottom:8px;"><i class="fas fa-trophy"
                        style="color:#f59e0b; margin-right:12px;"></i>Leaderboard</h1>
                <p style="color:#999; font-size:14px;">Top learners ranked by EduTokens</p>
            </div>

            <!-- My Stats -->
            <div class="glass-card" style="border-radius:12px; padding:20px; margin-bottom:24px;">
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <div style="display:flex; align-items:center; gap:14px;">
                        <div
                            style="width:44px; height:44px; border-radius:50%; background:linear-gradient(135deg, #55D6BE, #0F5257); display:flex; align-items:center; justify-content:center;">
                            <span id="my-initial" style="font-weight:700; color:white; font-size:16px;">U</span>
                        </div>
                        <div>
                            <p id="my-name" style="font-weight:700; font-size:16px;">You</p>
                            <p style="color:#999; font-size:12px;">Your stats</p>
                        </div>
                    </div>
                    <div style="display:flex; gap:24px; text-align:center;">
                        <div>
                            <p style="color:#999; font-size:10px; text-transform:uppercase;">Tokens</p>
                            <p id="my-tokens" style="font-weight:700; font-size:22px; color:#55D6BE;">0</p>
                        </div>
                        <div>
                            <p style="color:#999; font-size:10px; text-transform:uppercase;">Explore</p>
                            <p id="my-explore" style="font-weight:700; font-size:22px; color:#a855f7;">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Table -->
            <div class="glass-card" style="border-radius:12px; padding:24px;">
                <div id="leaderboard-list" style="display:flex; flex-direction:column; gap:8px;">
                    <p style="color:#666; font-size:14px; text-align:center; padding:24px;">Loading...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const token = localStorage.getItem('eduhub_token');
        if (!token) window.location.href = '/login';

        async function authFetch(url, options = {}) {
            options.headers = options.headers || {};
            options.headers['Authorization'] = 'Bearer ' + token;
            return fetch(url, options);
        }

        function logout() {
            localStorage.removeItem('eduhub_token');
            localStorage.removeItem('eduhub_user');
            window.location.href = '/login';
        }

        function getRankStyle(rank) {
            if (rank === 1) return 'background:linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.05)); border-left:4px solid #f59e0b;';
            if (rank === 2) return 'background:linear-gradient(135deg, rgba(192,192,192,0.15), rgba(192,192,192,0.05)); border-left:4px solid #c0c0c0;';
            if (rank === 3) return 'background:linear-gradient(135deg, rgba(205,127,50,0.15), rgba(205,127,50,0.05)); border-left:4px solid #cd7f32;';
            return 'background:rgba(255,255,255,0.03); border-left:4px solid transparent;';
        }

        function getRankEmoji(rank) {
            if (rank === 1) return 'ðŸ¥‡';
            if (rank === 2) return 'ðŸ¥ˆ';
            if (rank === 3) return 'ðŸ¥‰';
            return `<span style="color:#666; font-size:14px; width:24px; text-align:center;">${rank}</span>`;
        }

        async function loadLeaderboard() {
            try {
                // My stats
                const meRes = await authFetch('/api/tokens/me');
                const me = await meRes.json();
                document.getElementById('my-name').textContent = me.name || 'You';
                document.getElementById('my-initial').textContent = (me.name || 'U').charAt(0).toUpperCase();
                document.getElementById('my-tokens').textContent = me.edutokens || 0;
                document.getElementById('my-explore').textContent = me.explore_score || 0;

                // Leaderboard
                const res = await authFetch('/api/leaderboard');
                const data = await res.json();
                const container = document.getElementById('leaderboard-list');

                if (data.leaderboard.length === 0) {
                    container.innerHTML = '<p style="color:#666; font-size:14px; text-align:center; padding:24px;">No users yet. Be the first to earn tokens!</p>';
                    return;
                }

                container.innerHTML = data.leaderboard.map(u => `
                    <div style="display:flex; align-items:center; gap:14px; padding:14px 16px; border-radius:10px; ${getRankStyle(u.rank)} transition:transform 0.2s;" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='translateX(0)'">
                        <div style="font-size:20px; min-width:32px; text-align:center;">${getRankEmoji(u.rank)}</div>
                        <div style="width:36px; height:36px; border-radius:50%; background:#0F5257; display:flex; align-items:center; justify-content:center; font-weight:700; color:#55D6BE; font-size:14px; flex-shrink:0;">
                            ${(u.name || 'U').charAt(0).toUpperCase()}
                        </div>
                        <div style="flex:1;">
                            <p style="font-weight:600; font-size:14px;">${u.name}</p>
                            <p style="color:#999; font-size:11px;">${u.college || 'Unknown College'}</p>
                        </div>
                        <div style="text-align:right;">
                            <p style="font-weight:700; color:#55D6BE; font-size:16px;">${u.edutokens} <span style="font-size:11px; color:#999;">tokens</span></p>
                            <p style="color:#a855f7; font-size:11px;">${u.explore_score} explore</p>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error(e);
            }
        }

        loadLeaderboard();
    </script>
</body>

</html>